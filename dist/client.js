"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Serversinc=exports.ApiError=void 0;const apiTokens_1=require("./resources/apiTokens"),alerts_1=require("./resources/alerts"),applications_1=require("./resources/applications"),servers_1=require("./resources/servers"),user_1=require("./resources/user"),workspaces_1=require("./resources/workspaces"),integrations_1=require("./resources/integrations"),providers_1=require("./resources/providers"),deployments_1=require("./resources/deployments"),notifications_1=require("./resources/notifications"),projects_1=require("./resources/projects"),templates_1=require("./resources/templates"),github_1=require("./resources/github");class ApiError extends Error{constructor(e,s,r){super(`HTTP ${e}: ${s}${r?` - ${r}`:""}`),this.status=e,this.statusText=s,this.body=r,this.name="ApiError"}}exports.ApiError=ApiError;class Serversinc{constructor(e,s,r={}){this.apiTokens=(0,apiTokens_1.apiTokens)(this),this.alerts=(0,alerts_1.alerts)(this),this.applications=(0,applications_1.applications)(this),this.servers=(0,servers_1.servers)(this),this.user=(0,user_1.user)(this),this.workspaces=(0,workspaces_1.workspaces)(this),this.integrations=(0,integrations_1.integrations)(this),this.providers=(0,providers_1.providers)(this),this.deployments=(0,deployments_1.deployments)(this),this.notifications=(0,notifications_1.notifications)(this),this.projects=(0,projects_1.projects)(this),this.templates=(0,templates_1.templates)(this),this.github=(0,github_1.github)(this),this.baseURL=e.replace(/\/$/,""),this.token=s,this.timeout=r.timeout??3e4,this.retries=r.retries??3}setToken(e){this.token=e}async request(e,s,r,t,i=!0){const o=`${this.baseURL}${s}`;for(let s=0;s<=this.retries;s++)try{const s=new AbortController,n=setTimeout(()=>s.abort(),this.timeout),a={...t};i&&(a.Authorization=`Bearer ${this.token}`),r&&!a["Content-Type"]&&(a["Content-Type"]="application/json");const p=await fetch(o,{method:e,headers:a,body:r?JSON.stringify(r):void 0,signal:s.signal});if(clearTimeout(n),!p.ok){const e=await p.text();throw new ApiError(p.status,p.statusText,e)}if(204===p.status)return;return p.json()}catch(e){if(e instanceof ApiError)throw e;if(s===this.retries)throw e;await new Promise(e=>setTimeout(e,1e3*Math.pow(2,s)))}throw new Error("Unexpected error in request loop")}}exports.Serversinc=Serversinc,Serversinc.VERSION="1.0.0";