import{apiTokens}from"./resources/apiTokens";import{alerts}from"./resources/alerts";import{applications}from"./resources/applications";import{servers}from"./resources/servers";import{events}from"./resources/events";export class ApiError extends Error{constructor(t,e,s){super(`HTTP ${t}: ${e}${s?` - ${s}`:""}`),this.status=t,this.statusText=e,this.body=s,this.name="ApiError"}}export class Serversinc{constructor(t,e,s={}){this.apiTokens=apiTokens(this),this.alerts=alerts(this),this.applications=applications(this),this.servers=servers(this),this.events=events(this),this.baseURL=t.replace(/\/$/,""),this.token=e,this.timeout=s.timeout??3e4,this.retries=s.retries??3}setToken(t){this.token=t}async request(t,e,s,r,i=!0){const o=`${this.baseURL}${e}`;for(let e=0;e<=this.retries;e++)try{const e=new AbortController,n=setTimeout(()=>e.abort(),this.timeout),a={...r};i&&(a.Authorization=`Bearer ${this.token}`),s&&!a["Content-Type"]&&(a["Content-Type"]="application/json");const h=await fetch(o,{method:t,headers:a,body:s?JSON.stringify(s):void 0,signal:e.signal});if(clearTimeout(n),!h.ok){const t=await h.text();throw new ApiError(h.status,h.statusText,t)}if(204===h.status)return;return h.json()}catch(t){if(t instanceof ApiError)throw t;if(e===this.retries)throw t;await new Promise(t=>setTimeout(t,1e3*Math.pow(2,e)))}throw new Error("Unexpected error in request loop")}}Serversinc.VERSION="1.0.0";